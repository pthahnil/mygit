<!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8">
	<title>HomePage</title>
	<link rel="stylesheet" type="text/css" href="easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="easyui/themes/icon.css">
	<script type="text/javascript" src="easyui/jquery.js"></script>
	<script type="text/javascript" src="easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="easyui/locale/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript">
		var url;

		function append(){
			var tm = $('#tt');
			var node = tm.tree('getSelected');
			if(node){
				$('#mudlg').dialog('open').dialog('setTitle','添加部门');
				$('#fm').form('clear');
				url = 'dept!add.action?pid='+node.id;
			}
		}

		function saveDept(){
			$('#fm').form('submit',{
				url:url,
				onSubmit:function(){
					return $(this).form('validate');
				},success:function(result){
					if(result.msg){
						$.messager.alert('系统提示!',result.msg);
						return;
					}else{
						$.messager.alert("系统提示","保存成功！");
						$('#mudlg').dialog('close');
						$("#tt").tree("reload");
					}
				}
			})
		}

		function editDept(){
			var tm = $('#tt');
			var node = tm.tree('getSelected');
			if(node){
				$('#mudlg').dialog('open').dialog('setTitle','编辑部门');
				$('#fm').form('load',node);
				url = 'dept!add.action?id='+node.id;
			}
		}

		function removeit(){
			var tm = $('#tt');
			var node = tm.tree('getSelected');
			if(node){
				$.messager.confirm("系统提示","你确定要删除该部门？",function(e){
					if(e){
						$.post('dept!delete.action',{id:node.id},function(result){
							if(result.msg){
								$.messager.alert("系统提示",result.msg);
							}else{
								$.messager.alert("系统提示","删除成功！");
								$("#tt").tree('reload');
							}
						});
					}
				})
				url = 'dept!add.action?id='+node.id;
			}
		}
	</script>
</head>
<body class="easyui-layout">
	<div id="menu" data-options="region:'west',split:true,title:'部门'" style="width:200px;" >
		<div title="部门">
			<div id="treeDiv" >
				<ul id="tt" class="easyui-tree" data-options="
					url: 'dept!getAll.action',
					method: 'get',
					animate: true,
					lines:true,
					onContextMenu: function(e,node){
						e.preventDefault();
						$(this).tree('select',node.target);
						$('#popmenu').menu('show',{
							left: e.pageX,
							top: e.pageY
						});
					},
					onDblClick:function(node){
						$.messager.alert('系统提示！','构思中!');
					}
				"></ul>
			</div>
		</div>
	</div>
	<div id="popmenu" class="easyui-menu" style="width:120px;">
		<div onclick="append()" data-options="iconCls:'icon-add'">添加子部门</div>
		<div onclick="editDept()" data-options="iconCls:'icon-edit'">编辑部门信息</div>
		<div onclick="removeit()" data-options="iconCls:'icon-remove'">删除子部门</div>
		<div class="menu-sep"></div>
	</div>
	<div id="mudlg" class="easyui-dialog" style="width:400px;height:250px;padding:10px 20px"
		closed="true" buttons="#dlg-buttons">
		 <form id="fm" method="post">
        	<table cellspacing="10px;">
        		<tr>
        			<td>部门名称：</td>
        			<td><input name="dname" class="easyui-validatebox" required="true" style="width: 200px;"></td>
        		</tr>
        		<tr>
        			<td>描述：</td>
        			<td><input name="descpt" class="easyui-validatebox" style="width: 200px;"></td>
        		</tr>
        	</table>
        </form>
	</div>
	<div id="dlg-buttons">
		<a class="easyui-linkbutton" href="javascript:void(0)" onclick="saveDept()">保存信息</a>
		<a class="easyui-linkbutton" href="javascript:void(0)" onclick="avascript:$('#mudlg').dialog('close')">关闭窗口</a>
	</div>
	<!-- data-->
	<div data-options="region:'center',title:'部门人员'" style="height: 30px">
		<div id="tabs" class="easyui-tabs" style="width: 100%;height: 100%" fit="true"></div>
	</div>
	<!-- data end -->
</body>
</html>
